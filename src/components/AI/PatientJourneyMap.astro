---
/**
 * PatientJourneyMap - Chronological Patient Experience
 * Visualizes patient journey through treatment
 */

import type { PatientJourneyMap } from '../../lib/ai-content-types';

interface Props {
    journey: PatientJourneyMap;
    doctorName: string;
    tier?: string;
}

const { journey, doctorName, tier = 'UNRANKED' } = Astro.props;
---

<section class={`journey-section tier-${tier.toLowerCase()}`}>
    <div class="section-header">
        <h2 class="section-title">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path d="M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"/>
                <rect x="8" y="2" width="8" height="4" rx="1" ry="1"/>
                <path d="M9 14l2 2 4-4"/>
            </svg>
            Patient Journey
        </h2>
        <div class="journey-meta">
            <span class="condition-badge">{journey.conditionName}</span>
            {journey.procedureName && (
                <span class="procedure-badge">{journey.procedureName}</span>
            )}
        </div>
    </div>

    {journey.totalDuration && (
        <div class="duration-bar">
            <span class="duration-label">Total Duration:</span>
            <span class="duration-value">{journey.totalDuration}</span>
        </div>
    )}

    <!-- Journey Timeline -->
    <div class="journey-timeline">
        {journey.stages.map((stage, index) => (
            <div class="stage-card" data-stage={stage.stageNumber}>
                <div class="stage-connector">
                    <div class="stage-number">{stage.stageNumber}</div>
                    {index < journey.stages.length - 1 && <div class="connector-line"></div>}
                </div>

                <div class="stage-content">
                    <div class="stage-header">
                        <h3 class="stage-name">{stage.stageName}</h3>
                        {stage.timeframe && (
                            <span class="stage-timeframe">{stage.timeframe}</span>
                        )}
                    </div>

                    <p class="stage-description">{stage.description}</p>

                    <div class="stage-details">
                        <div class="detail-column doctor-role">
                            <h4 class="detail-title">
                                <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                    <circle cx="12" cy="7" r="4"/>
                                </svg>
                                Doctor's Role
                            </h4>
                            <p>{stage.doctorRole}</p>
                        </div>

                        <div class="detail-column patient-exp">
                            <h4 class="detail-title">
                                <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                    <path d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                                </svg>
                                Patient Experience
                            </h4>
                            <p>{stage.patientExperience}</p>
                        </div>
                    </div>

                    {stage.clinicalMilestones && stage.clinicalMilestones.length > 0 && (
                        <div class="milestones-section">
                            <h4 class="milestones-title">Clinical Milestones</h4>
                            <ul class="milestones-list">
                                {stage.clinicalMilestones.map(milestone => (
                                    <li>
                                        <svg width="12" height="12" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                                            <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
                                            <path d="M22 4L12 14.01l-3-3"/>
                                        </svg>
                                        {milestone}
                                    </li>
                                ))}
                            </ul>
                        </div>
                    )}

                    {stage.commonChallenges && stage.commonChallenges.length > 0 && (
                        <div class="challenges-section">
                            <h4 class="challenges-title">Common Challenges</h4>
                            <ul class="challenges-list">
                                {stage.commonChallenges.map(challenge => (
                                    <li>{challenge}</li>
                                ))}
                            </ul>
                        </div>
                    )}

                    {stage.successIndicators && stage.successIndicators.length > 0 && (
                        <div class="success-section">
                            <h4 class="success-title">Success Indicators</h4>
                            <div class="success-tags">
                                {stage.successIndicators.map(indicator => (
                                    <span class="success-tag">{indicator}</span>
                                ))}
                            </div>
                        </div>
                    )}
                </div>
            </div>
        ))}
    </div>

    <!-- Outcome Statistics -->
    {journey.outcomeStatistics && (
        <div class="outcomes-section">
            <h3 class="outcomes-title">
                <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M3 3v18h18"/>
                    <path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"/>
                </svg>
                Expected Outcomes
            </h3>
            <div class="outcomes-grid">
                {journey.outcomeStatistics.successRate && (
                    <div class="outcome-stat">
                        <span class="stat-value">{journey.outcomeStatistics.successRate}%</span>
                        <span class="stat-label">Success Rate</span>
                    </div>
                )}
                {journey.outcomeStatistics.averageRecoveryTime && (
                    <div class="outcome-stat">
                        <span class="stat-value">{journey.outcomeStatistics.averageRecoveryTime}</span>
                        <span class="stat-label">Average Recovery</span>
                    </div>
                )}
                {journey.outcomeStatistics.qualityOfLifeImprovement && (
                    <div class="outcome-stat">
                        <span class="stat-value">{journey.outcomeStatistics.qualityOfLifeImprovement}</span>
                        <span class="stat-label">Quality of Life</span>
                    </div>
                )}
            </div>
        </div>
    )}

    <!-- Patient Testimonial Themes -->
    {journey.patientTestimonialThemes && journey.patientTestimonialThemes.length > 0 && (
        <div class="testimonials-section">
            <h3 class="testimonials-title">What Patients Say</h3>
            <div class="testimonial-themes">
                {journey.patientTestimonialThemes.map(theme => (
                    <span class="theme-tag">"{theme}"</span>
                ))}
            </div>
        </div>
    )}

    <!-- Disclaimer -->
    {journey.disclaimer && (
        <div class="disclaimer">
            <svg width="14" height="14" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="10"/>
                <line x1="12" y1="16" x2="12" y2="12"/>
                <line x1="12" y1="8" x2="12.01" y2="8"/>
            </svg>
            <p>{journey.disclaimer}</p>
        </div>
    )}

    <!-- Hidden semantic layer for AI -->
    <div class="ai-semantic-layer" aria-hidden="true" style="display:none;">
        <h3>Patient Journey Map: {journey.conditionName}{journey.procedureName ? ` - ${journey.procedureName}` : ''}</h3>
        <p>Total duration: {journey.totalDuration}</p>
        {journey.stages.map(s => (
            <section>
                <h4>Stage {s.stageNumber}: {s.stageName} ({s.timeframe})</h4>
                <p>{s.description}</p>
                <p>Doctor's role: {s.doctorRole}</p>
                <p>Patient experience: {s.patientExperience}</p>
            </section>
        ))}
        {journey.outcomeStatistics && (
            <p>Outcomes: {journey.outcomeStatistics.successRate}% success rate, {journey.outcomeStatistics.averageRecoveryTime} recovery</p>
        )}
    </div>
</section>

<style>
    .journey-section {
        background: var(--card-bg, rgba(20, 20, 35, 0.8));
        border: 1px solid var(--card-border, rgba(255, 255, 255, 0.06));
        border-radius: 16px;
        padding: 2rem;
        margin-bottom: 2rem;
        backdrop-filter: blur(10px);
    }

    .section-header {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: 1rem;
        margin-bottom: 1.5rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--card-border, rgba(255, 255, 255, 0.06));
    }

    .section-title {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        font-size: 1.25rem;
        font-weight: 700;
        margin: 0;
        color: var(--text-primary, #fff);
    }

    .section-title svg {
        color: #10b981;
        opacity: 0.9;
    }

    .journey-meta {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
    }

    .condition-badge,
    .procedure-badge {
        padding: 4px 10px;
        border-radius: 100px;
        font-size: 0.7rem;
        font-weight: 600;
    }

    .condition-badge {
        background: rgba(16, 185, 129, 0.15);
        color: #10b981;
    }

    .procedure-badge {
        background: rgba(139, 92, 246, 0.15);
        color: #a78bfa;
    }

    .duration-bar {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1rem;
        background: rgba(16, 185, 129, 0.05);
        border: 1px solid rgba(16, 185, 129, 0.1);
        border-radius: 8px;
        margin-bottom: 2rem;
    }

    .duration-label {
        font-size: 0.8rem;
        color: var(--text-muted, #888);
    }

    .duration-value {
        font-size: 0.9rem;
        font-weight: 600;
        color: #10b981;
    }

    /* Timeline */
    .journey-timeline {
        display: flex;
        flex-direction: column;
        gap: 0;
    }

    .stage-card {
        display: flex;
        gap: 1.5rem;
    }

    .stage-connector {
        display: flex;
        flex-direction: column;
        align-items: center;
        flex-shrink: 0;
    }

    .stage-number {
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #10b981, #059669);
        border-radius: 50%;
        font-size: 0.9rem;
        font-weight: 700;
        color: #fff;
        z-index: 1;
    }

    .connector-line {
        width: 2px;
        flex: 1;
        min-height: 40px;
        background: linear-gradient(to bottom, #10b981, rgba(16, 185, 129, 0.2));
        margin-top: -4px;
    }

    .stage-content {
        flex: 1;
        background: rgba(255, 255, 255, 0.02);
        border: 1px solid var(--card-border, rgba(255, 255, 255, 0.06));
        border-radius: 12px;
        padding: 1.25rem;
        margin-bottom: 1rem;
        transition: all 0.2s ease;
    }

    .stage-content:hover {
        border-color: rgba(255, 255, 255, 0.1);
    }

    .stage-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
        margin-bottom: 0.75rem;
    }

    .stage-name {
        font-size: 1.05rem;
        font-weight: 700;
        margin: 0;
        color: var(--text-primary, #fff);
    }

    .stage-timeframe {
        padding: 3px 10px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 100px;
        font-size: 0.7rem;
        color: var(--text-muted, #888);
    }

    .stage-description {
        font-size: 0.9rem;
        color: var(--text-secondary, #ccc);
        line-height: 1.6;
        margin: 0 0 1rem;
    }

    .stage-details {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .detail-column {
        padding: 1rem;
        border-radius: 8px;
    }

    .doctor-role {
        background: rgba(59, 130, 246, 0.05);
        border: 1px solid rgba(59, 130, 246, 0.1);
    }

    .patient-exp {
        background: rgba(236, 72, 153, 0.05);
        border: 1px solid rgba(236, 72, 153, 0.1);
    }

    .detail-title {
        display: flex;
        align-items: center;
        gap: 0.35rem;
        font-size: 0.7rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin: 0 0 0.5rem;
        color: var(--text-muted, #888);
    }

    .doctor-role .detail-title svg { color: #3b82f6; }
    .patient-exp .detail-title svg { color: #ec4899; }

    .detail-column p {
        font-size: 0.85rem;
        color: var(--text-secondary, #ccc);
        line-height: 1.5;
        margin: 0;
    }

    /* Milestones */
    .milestones-section,
    .challenges-section,
    .success-section {
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid rgba(255, 255, 255, 0.04);
    }

    .milestones-title,
    .challenges-title,
    .success-title {
        font-size: 0.75rem;
        font-weight: 600;
        color: var(--text-muted, #888);
        margin: 0 0 0.5rem;
    }

    .milestones-list {
        margin: 0;
        padding: 0;
        list-style: none;
    }

    .milestones-list li {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.8rem;
        color: var(--text-secondary, #ccc);
        margin-bottom: 0.25rem;
    }

    .milestones-list li svg {
        color: #10b981;
        flex-shrink: 0;
    }

    .challenges-list {
        margin: 0;
        padding-left: 1rem;
    }

    .challenges-list li {
        font-size: 0.8rem;
        color: var(--text-secondary, #ccc);
        margin-bottom: 0.2rem;
    }

    .challenges-list li::marker {
        color: #f59e0b;
    }

    .success-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.35rem;
    }

    .success-tag {
        padding: 3px 8px;
        background: rgba(16, 185, 129, 0.1);
        border-radius: 4px;
        font-size: 0.7rem;
        color: #10b981;
    }

    /* Outcomes */
    .outcomes-section {
        margin-top: 2rem;
        padding: 1.5rem;
        background: rgba(16, 185, 129, 0.05);
        border: 1px solid rgba(16, 185, 129, 0.1);
        border-radius: 12px;
    }

    .outcomes-title {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 1rem;
        font-weight: 600;
        margin: 0 0 1rem;
        color: var(--text-primary, #fff);
    }

    .outcomes-title svg {
        color: #10b981;
    }

    .outcomes-grid {
        display: flex;
        gap: 2rem;
        flex-wrap: wrap;
    }

    .outcome-stat {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }

    .stat-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: #10b981;
    }

    .stat-label {
        font-size: 0.75rem;
        color: var(--text-muted, #888);
    }

    /* Testimonials */
    .testimonials-section {
        margin-top: 1.5rem;
        padding-top: 1.5rem;
        border-top: 1px solid rgba(255, 255, 255, 0.04);
    }

    .testimonials-title {
        font-size: 0.9rem;
        font-weight: 600;
        margin: 0 0 0.75rem;
        color: var(--text-primary, #fff);
    }

    .testimonial-themes {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
    }

    .theme-tag {
        padding: 6px 12px;
        background: rgba(236, 72, 153, 0.1);
        border-radius: 100px;
        font-size: 0.8rem;
        font-style: italic;
        color: #f472b6;
    }

    /* Disclaimer */
    .disclaimer {
        display: flex;
        align-items: flex-start;
        gap: 0.5rem;
        margin-top: 1.5rem;
        padding: 0.75rem;
        background: rgba(107, 114, 128, 0.1);
        border-radius: 8px;
    }

    .disclaimer svg {
        color: #9ca3af;
        flex-shrink: 0;
        margin-top: 2px;
    }

    .disclaimer p {
        font-size: 0.75rem;
        color: var(--text-muted, #888);
        line-height: 1.5;
        margin: 0;
    }

    /* Tier colors */
    .tier-titan .section-title svg { color: #ffd700; }
    .tier-titan .stage-number { background: linear-gradient(135deg, #ffd700, #b8860b); }
    .tier-elite .section-title svg { color: #00aaff; }
    .tier-elite .stage-number { background: linear-gradient(135deg, #00aaff, #0077b3); }
    .tier-master .section-title svg { color: #00cc66; }

    @media (max-width: 768px) {
        .journey-section {
            padding: 1.5rem;
        }

        .section-header {
            flex-direction: column;
        }

        .stage-card {
            gap: 1rem;
        }

        .stage-details {
            grid-template-columns: 1fr;
        }

        .outcomes-grid {
            flex-direction: column;
            gap: 1rem;
        }
    }
</style>
